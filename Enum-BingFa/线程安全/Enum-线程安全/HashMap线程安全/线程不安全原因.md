###
线程不安全的原因:

在多线程环境下，
假设有容器map，
其存储的情况如下图所示
（淡蓝色为已有数据）。

![](1.jpg)

此时的map已经达到了扩容阈值12（16 * 0.75 = 12），  
而此时线程A与线程B同时对map容器进行插入操作，那么都需要扩容。  
此时可能出现的情况如下：  
线程A与线程B都进行了扩容，  
此时便有两个新的table，  
那么再赋值给原先的table变量时，  
便会出现其中一个newTable会被覆盖，  
假如线程B扩容的newTable覆盖了线程A扩容的newTable，  
并且是在A已经执行了插入操作之后，  
那么就会出现线程A的插入失效问题，  
也即是如下图中的两个table只能有一个会最后存在，  
而其中一个插入的值会被舍弃的问题。  

![](2.jpg)
